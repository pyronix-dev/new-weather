module.exports=[52470,a=>{"use strict";var b=a.i(16552),c=a.i(8284),d=a.i(59389),e=a.i(80630);let f=()=>(0,b.jsxs)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",children:[(0,b.jsx)("circle",{cx:"12",cy:"12",r:"5",fill:"#FBBF24"}),(0,b.jsxs)("g",{stroke:"#FBBF24",strokeWidth:"2",strokeLinecap:"round",children:[(0,b.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),(0,b.jsx)("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),(0,b.jsx)("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),(0,b.jsx)("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),(0,b.jsx)("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),(0,b.jsx)("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),(0,b.jsx)("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),(0,b.jsx)("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})]}),g=()=>(0,b.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[(0,b.jsx)("path",{d:"M1 4v6h6M23 20v-6h-6"}),(0,b.jsx)("path",{d:"M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"})]}),h=({className:a})=>(0,b.jsx)("div",{className:`animate-pulse bg-slate-200 rounded ${a}`}),i=[{id:"soleil",label:"Soleil",icon:f},{id:"eclaircies",label:"Éclaircies",icon:()=>(0,b.jsxs)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",children:[(0,b.jsx)("circle",{cx:"9",cy:"9",r:"4",fill:"#FBBF24"}),(0,b.jsxs)("g",{stroke:"#FBBF24",strokeWidth:"1.5",strokeLinecap:"round",children:[(0,b.jsx)("line",{x1:"9",y1:"2",x2:"9",y2:"3"}),(0,b.jsx)("line",{x1:"15.36",y1:"4.64",x2:"14.66",y2:"5.34"}),(0,b.jsx)("line",{x1:"2",y1:"9",x2:"3",y2:"9"}),(0,b.jsx)("line",{x1:"3.34",y1:"4.64",x2:"4.04",y2:"5.34"})]}),(0,b.jsx)("path",{d:"M17 18H7a4 4 0 01-1.5-7.71 5 5 0 019.92.38A3.5 3.5 0 0117 18z",fill:"#E5E7EB",stroke:"#D1D5DB",strokeWidth:"0.5"})]})},{id:"nuageux",label:"Nuageux",icon:()=>(0,b.jsx)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",children:(0,b.jsx)("path",{d:"M18 18H6a4 4 0 01-1.5-7.71 5 5 0 019.92.38A3.5 3.5 0 0118 18z",fill:"#D1D5DB",stroke:"#9CA3AF",strokeWidth:"0.5"})})},{id:"pluie",label:"Pluie",icon:()=>(0,b.jsxs)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",children:[(0,b.jsx)("path",{d:"M16 13H6a4 4 0 01-1.5-7.71 5 5 0 019.92.38A3.5 3.5 0 0116 13z",fill:"#D1D5DB",stroke:"#9CA3AF",strokeWidth:"0.5"}),(0,b.jsxs)("g",{stroke:"#60A5FA",strokeWidth:"2",strokeLinecap:"round",children:[(0,b.jsx)("line",{x1:"8",y1:"15",x2:"8",y2:"19"}),(0,b.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"21"}),(0,b.jsx)("line",{x1:"16",y1:"15",x2:"16",y2:"18"})]})]})},{id:"orage",label:"Orage",icon:()=>(0,b.jsxs)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,b.jsx)("path",{d:"M11 5 6 9H2v6h4l5 4V5Z",fill:"none",stroke:"none"}),(0,b.jsx)("path",{d:"M19 16.9A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9",stroke:"#6B7280"}),(0,b.jsx)("path",{d:"M13 11l-4 6h6l-4 6",stroke:"#FBBF24",fill:"#FBBF24"})]})},{id:"vent",label:"Vent",icon:()=>(0,b.jsxs)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"#64748B",strokeWidth:"2",strokeLinecap:"round",children:[(0,b.jsx)("path",{d:"M9.59 4.59A2 2 0 1111 8H2"}),(0,b.jsx)("path",{d:"M12.59 19.41A2 2 0 1014 16H2"}),(0,b.jsx)("path",{d:"M17.73 7.73A2.5 2.5 0 1119.5 12H2"})]})},{id:"houle",label:"Houle",icon:()=>(0,b.jsxs)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"#3B82F6",strokeWidth:"2",strokeLinecap:"round",children:[(0,b.jsx)("path",{d:"M2 10c2-2 4-3 6-3s4 2 6 3 4 1.5 6 0"}),(0,b.jsx)("path",{d:"M2 16c2-2 4-3 6-3s4 2 6 3 4 1.5 6 0"})]})},{id:"cyclone",label:"Cyclone",icon:()=>(0,b.jsx)("svg",{className:"w-6 h-6",viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,b.jsxs)("g",{fill:"#4fd1d9",children:[(0,b.jsx)("path",{d:"M58 33.2c-.4-14.1-12.6-24.7-26.7-22.1c-12 2.2-19.3 15.1-13.9 26.1c2.6 5.4 9.1 7.8 14.8 6.5c6-1.3 9.2-8.5 6.9-13.9c-1.3-3-6.3-1.7-5 1.4c2.4 5.7-3.6 9.1-8.5 7c-3.7-1.6-4.9-5.9-4.9-9.6c.1-9.1 10.7-14 18.7-12.6c10.2 1.9 14.6 13.6 13 22.8c-1.7 9.9-10.8 16.5-20.3 18.2c-3.3.6-1.9 5.6 1.4 5C47.6 59.4 58.4 47.8 58 33.2"}),(0,b.jsx)("path",{d:"M46.6 25.5c-6.4-11.2-25.6-4.9-21 8.2c1.1 3.1 6.1 1.8 5-1.4c-1.7-4.9 1.7-8.3 6.9-7.6c4 .6 6 5.1 6.4 8.6C45.4 45 31.8 51.1 22.5 47c-8.8-3.9-12.7-13.9-10.6-22.9c2.2-9 10.7-16.2 19.9-16.9c3.3-.3 3.3-5.4 0-5.2C18 3.1 7.1 14.4 6.1 28C5 41.6 16.8 54.1 30.5 53.6c14-.5 23-16.1 16.1-28.1"})]})})},{id:"brume",label:"Brume",icon:()=>(0,b.jsxs)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"#9CA3AF",strokeWidth:"2",strokeLinecap:"round",children:[(0,b.jsx)("path",{d:"M4 8h16"}),(0,b.jsx)("path",{d:"M6 12h12"}),(0,b.jsx)("path",{d:"M4 16h16"}),(0,b.jsx)("path",{d:"M8 20h8"})]})}];function j({initialUser:a}){let[j,k]=(0,c.useState)(!0),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(null),B=(0,c.useRef)(null),C=(0,c.useRef)(null),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let a=()=>G(window.innerWidth>=1280);return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),(0,c.useEffect)(()=>{let a=a=>{let b=a.target;b.closest("[data-marker-popup]")||b.closest("[data-marker-button]")||A(null)};if(z)return document.addEventListener("click",a),()=>document.removeEventListener("click",a)},[z]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{k(!1)},1200);return()=>clearTimeout(a)},[]),(0,c.useEffect)(()=>{let a=()=>{let a,b,c,d;if(!B.current||!C.current||!l)return;let e=B.current,f=C.current,g=e.getBoundingClientRect(),h=f.naturalWidth,i=f.naturalHeight,j=g.width,k=g.height,m=h/i;m>j/k?(a=j,c=0,d=(k-(b=j/m))/2):(b=k,c=(j-(a=k*m))/2,d=0),E({left:c,top:d,width:a,height:b})};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[l]),(0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/observations");if(a.ok){let b=(await a.json()).map(a=>({id:a.id,x:Number(a.x),y:Number(a.y),type:a.type,temp:a.temp,details:a.details,createdAt:new Date(a.created_at)}));u(b)}}catch(a){console.error("Failed to fetch observations",a)}})()},[]);let H=async()=>{if(n&&x&&r.trim()){k(!0);try{let a=await fetch("/api/observations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:n,x:x.x,y:x.y,temp:p,details:r})});if(a.ok){let b=await a.json(),c={id:b.id,x:Number(b.x),y:Number(b.y),type:b.type,temp:b.temp,details:b.details,createdAt:new Date(b.created_at)};u([c,...t]),o(null),q(""),s(""),y(null)}else alert("Erreur lors de la publication")}catch(a){console.error("Error publishing",a),alert("Erreur de connexion")}finally{k(!1)}}},I=(a,b)=>{if(!D||!B.current)return{left:`${a}%`,top:`${b}%`};let c=B.current.getBoundingClientRect(),d=D.left+a/100*D.width,e=D.top+b/100*D.height,f=d/c.width*100,g=e/c.height*100;return{left:`${f}%`,top:`${g}%`}};return(0,b.jsxs)("div",{className:"min-h-screen bg-stone-50 flex flex-col",children:[(0,b.jsx)(d.Header,{initialUser:a}),(0,b.jsx)("main",{className:"flex-1 w-full px-4 sm:px-6 py-4 sm:py-6 relative",children:(0,b.jsxs)("div",{className:"flex flex-col xl:flex-row gap-4 sm:gap-6 transition-all duration-300",children:[(0,b.jsx)("div",{className:"w-full xl:w-auto animate-fade-in-up transition-all duration-300 xl:flex-[0_0_60%] xl:max-w-[60%]",children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl overflow-hidden border border-slate-200 shadow-sm hover:shadow-md transition-shadow duration-300",children:[(0,b.jsxs)("div",{className:"p-4 sm:p-6 border-b border-slate-200 flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[j?(0,b.jsxs)("div",{children:[(0,b.jsx)(h,{className:"h-7 w-48 mb-2"}),(0,b.jsx)(h,{className:"h-4 w-64"})]}):(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-slate-800",children:"Carte des observations"}),(0,b.jsx)("p",{className:"text-slate-500 text-xs sm:text-sm mt-1 font-medium",children:"Cliquez sur la carte pour signaler un événement météo."})]}),!j&&(0,b.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-50 border border-green-200 rounded-full self-start sm:self-auto",children:[(0,b.jsx)("span",{className:"text-xs font-bold text-slate-700",children:"EN DIRECT"}),(0,b.jsx)("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]})]}),j?(0,b.jsx)("div",{className:"aspect-[4/3] sm:aspect-[16/9] lg:aspect-[16/8] bg-slate-100 animate-pulse flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-8 h-8 border-2 border-slate-300 border-t-slate-600 rounded-full animate-spin"})}):(0,b.jsxs)("div",{ref:B,className:"relative cursor-crosshair overflow-hidden bg-slate-100 h-[800px] md:h-[650px]",onClick:a=>{if(!B.current||!D)return;A(null);let b=B.current.getBoundingClientRect(),c=a.clientX-b.left,d=a.clientY-b.top;c<D.left||c>D.left+D.width||d<D.top||d>D.top+D.height||y({x:(c-D.left)/D.width*100,y:(d-D.top)/D.height*100})},children:[!l&&(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-100 z-10",children:(0,b.jsx)("div",{className:"w-8 h-8 border-2 border-slate-300 border-t-slate-600 rounded-full animate-spin"})}),(0,b.jsx)("img",{ref:C,src:"https://raw.githubusercontent.com/pyronix-dev/upwork/main/map_bg.png",alt:"Carte de Martinique",className:`w-full h-full object-contain transition-opacity duration-500 ${l?"opacity-100":"opacity-0"}`,onLoad:()=>m(!0),draggable:!1},"map-image-static"),t.map(a=>{var c,d,e;let g,h,j=(c=a.type,(g=i.find(a=>a.id===c))?g.icon:f),k=!!(d=a.createdAt)&&(Date.now()-new Date(d).getTime())/36e5>12,l=I(a.x,a.y);return(0,b.jsxs)("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 animate-bounce-in z-20",style:{left:l.left,top:l.top},children:[(0,b.jsx)("button",{"data-marker-button":!0,onClick:b=>{b.stopPropagation(),A(z?.id===a.id?null:a)},className:`w-8 h-8 sm:w-10 sm:h-10 bg-white rounded-full shadow-lg border-2 border-slate-200 flex items-center justify-center hover:scale-110 transition-transform cursor-pointer ${k?"opacity-50":""}`,children:(0,b.jsx)(j,{})}),z?.id===a.id&&(0,b.jsxs)("div",{"data-marker-popup":!0,className:`absolute left-1/2 -translate-x-1/2 w-48 bg-white rounded-xl shadow-lg border border-slate-200 p-3 animate-fade-in-up z-30 ${a.y<25?"top-full mt-2":"bottom-full mb-2"}`,children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(j,{}),(0,b.jsx)("span",{className:"font-bold text-slate-800 text-sm",children:(e=a.type,(h=i.find(a=>a.id===e))?h.label:e)})]}),a.temp&&(0,b.jsxs)("p",{className:"text-sm text-slate-600 mb-1",children:[(0,b.jsx)("span",{className:"font-semibold",children:"Temp:"})," ",a.temp,"°C"]}),a.details&&(0,b.jsx)("p",{className:"text-xs text-slate-500",children:a.details}),k&&(0,b.jsx)("p",{className:"text-xs text-amber-600 mt-2 font-medium",children:"Observation > 48h"}),(0,b.jsx)("div",{className:`absolute left-1/2 -translate-x-1/2 w-0 h-0 border-l-8 border-r-8 border-l-transparent border-r-transparent ${a.y<25?"bottom-full border-b-8 border-b-white":"top-full border-t-8 border-t-white"}`})]})]},a.id)}),x&&(0,b.jsxs)("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 z-30",style:{left:I(x.x,x.y).left,top:I(x.x,x.y).top},children:[(0,b.jsx)("div",{className:"w-4 h-4 bg-amber-500/40 rounded-full border-2 border-amber-500 animate-pulse"}),(0,b.jsx)("div",{className:"absolute inset-0 w-4 h-4 bg-amber-500/20 rounded-full animate-ping"})]})]})]})}),(0,b.jsx)("div",{className:"w-full xl:flex-1 animate-fade-in-up transition-all duration-300",style:F?{flexBasis:"40%",maxWidth:"40%"}:{},children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm h-full",children:[(0,b.jsxs)("div",{className:"p-4 sm:p-6 border-b border-slate-200 flex items-center justify-between",children:[j?(0,b.jsxs)("div",{children:[(0,b.jsx)(h,{className:"h-6 w-48 mb-2"}),(0,b.jsx)(h,{className:"h-4 w-32"})]}):(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg sm:text-xl font-bold text-slate-800",children:"Signaler un événement"}),(0,b.jsx)("p",{className:"text-slate-500 text-xs sm:text-sm mt-1 font-medium",children:"Partagez vos observations météo"})]}),!j&&(0,b.jsx)("button",{onClick:()=>{w(!0),setTimeout(()=>{w(!1)},1500)},disabled:v,className:`p-2 rounded-xl border border-slate-200 text-slate-500 hover:bg-slate-50 hover:text-slate-700 transition-colors ${v?"animate-spin":""}`,children:(0,b.jsx)(g,{})})]}),(0,b.jsx)("div",{className:"p-4 sm:p-6 space-y-5 sm:space-y-6",children:j?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h,{className:"h-5 w-24 mb-3"}),(0,b.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[...Array(9)].map((a,c)=>(0,b.jsx)(h,{className:"h-16 rounded-xl"},c))})]}),(0,b.jsx)(h,{className:"h-12 w-full rounded-xl"}),(0,b.jsx)(h,{className:"h-24 w-full rounded-xl"}),(0,b.jsx)(h,{className:"h-12 w-full rounded-xl"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-3",children:"Type de phénomène"}),(0,b.jsx)("div",{className:"grid grid-cols-3 gap-2",children:i.map(a=>{let c=a.icon;return(0,b.jsxs)("button",{onClick:()=>o(a.id),className:`p-3 rounded-xl border-2 transition-all duration-200 flex flex-col items-center gap-1.5 hover:scale-105 ${n===a.id?"border-amber-500 bg-amber-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[(0,b.jsx)(c,{}),(0,b.jsx)("span",{className:"text-xs font-medium text-slate-700",children:a.label})]},a.id)})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Température (optionnel)"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("input",{type:"text",inputMode:"numeric",pattern:"-?[0-9]*",value:p,onChange:a=>{let b=a.target.value;(""===b||"-"===b||/^-?\d+$/.test(b))&&q(b)},onKeyDown:a=>{!["Backspace","Delete","Tab","Escape","Enter","ArrowLeft","ArrowRight"].includes(a.key)&&("-"!==a.key||""!==p)&&(/^\d$/.test(a.key)||a.preventDefault())},placeholder:"Ex: 28",className:"w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-amber-500/20 focus:border-amber-500 transition-all"}),(0,b.jsx)("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium",children:"°C"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Description"}),(0,b.jsx)("textarea",{value:r,onChange:a=>s(a.target.value),placeholder:"Décrivez ce que vous observez...",rows:3,className:"w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-amber-500/20 focus:border-amber-500 transition-all resize-none"})]}),a?(0,b.jsx)("button",{onClick:H,disabled:!n||!x||!r.trim(),className:"w-full py-3 rounded-xl font-bold text-white bg-slate-800 hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 hover:scale-[1.02] active:scale-[0.98]",children:"Publier l'observation"}):(0,b.jsxs)("div",{className:"bg-slate-100 rounded-xl p-4 text-center border border-slate-200",children:[(0,b.jsx)("p",{className:"text-sm text-slate-600 font-medium mb-3",children:"Vous devez être connecté pour signaler un événement."}),(0,b.jsx)("a",{href:"/login",className:"inline-block w-full py-2.5 rounded-lg bg-amber-500 hover:bg-amber-600 text-white font-bold text-sm transition-colors",children:"Se connecter"})]}),(!n||!x||!r.trim())&&(0,b.jsx)("p",{className:"text-xs text-slate-500 text-center",children:x?n?"Ajoutez une description":"Sélectionnez un type de phénomène":"Cliquez sur la carte pour sélectionner un emplacement"})]})})]})})]})}),(0,b.jsx)(e.Footer,{})]})}a.s(["default",()=>j])}];

//# sourceMappingURL=design-update_TypeScript_weather10_components_carte-client_tsx_7eaeb526._.js.map